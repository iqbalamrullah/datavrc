<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Vrc Yearbook Checker</title>
<style>
/* ===== BODY & BACKGROUND ===== */
body {
  font-family: 'Inter', Arial, sans-serif;
  margin: 0;
  padding: 20px;
  display: flex;
  justify-content: center;
  flex-direction: column; /* supaya konten bertumpuk vertikal */
  min-height: 100vh;
  position: relative;
  overflow: auto; /* biar scroll bisa muncul di HP */
}

body::before {
  content: '';
  position: fixed; /* fixed supaya background selalu ada */
  top: 0; left: 0;
  width: 100%;
  height: 100%;
  background-image: url('img/1.png');
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  z-index: -2;
}

body::after {
  content: '';
  position: fixed;
  top: 0; left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,0.3); /* overlay lebih ringan */
  z-index: -1;
}

/* ===== CARD ===== */
.card {
  width: 100%;
  max-width: 520px;
  margin: 20px auto;
  background: rgba(255,255,255,0.2); /* transparan untuk blur */
  padding: 25px;
  border-radius: 20px;
  box-shadow: 0 10px 40px rgba(0,0,0,0.3);
  backdrop-filter: blur(15px); /* blur tetap ada */
  color: #fff; /* teks putih biar terbaca */
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.card:hover {
  transform: translateY(-5px);
  box-shadow: 0 15px 50px rgba(0,0,0,0.4);
}

/* ===== TEXT & FORM ===== */
h1 {
  text-align: center;
  font-size: 24px;
  margin-bottom: 20px;
  color: #111827;
}

label {
  font-weight: 600;
  margin-top: 15px;
  display: block;
  color: #111827;
}

select, input[type="date"], button {
  display: block;
  width: 100%;
  margin-top: 8px;
  padding: 12px;
  border-radius: 10px;
  border: 1px solid #ccc;
  font-size: 15px;
  box-sizing: border-box;
  transition: all 0.3s;
}

select:focus, input:focus {
  outline: none;
  border-color: #2563eb;
  box-shadow: 0 0 8px rgba(37,99,235,0.3);
}

button {
  background: #2563eb;
  color: #fff;
  border: none;
  cursor: pointer;
  margin-top: 20px;
  font-weight: 600;
  font-size: 16px;
  transition: background 0.3s, transform 0.2s, box-shadow 0.3s;
}

button:hover {
  background: #1d4ed8;
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(37,99,235,0.4);
}

/* ===== RESULT ===== */
.result {
  margin-top: 20px;
  background: rgba(255, 255, 255, 0.95);
  color: #111827;
  padding: 18px;
  border-radius: 12px;
  display: none;
  animation: fadeIn 0.5s ease forwards;
  box-shadow: 0 8px 25px rgba(0,0,0,0.2);
}

.result div {
  margin-bottom: 8px;
}

.char-count {
  font-size: 13px;
  margin-left: 5px;
  color: #374151;
}

.char-count.warning {
  color: #b91c1c;
  font-weight: 700;
}

.warning-msg {
  display: block;
  margin-top: 4px;
  color: #b91c1c;
  font-weight: 700;
  font-size: 14px;
}

.notice {
  margin-top: 16px;
  padding: 12px;
  background: #fef3c7;
  border-left: 5px solid #f59e0b;
  border-radius: 6px;
  font-size: 14px;
  color: #92400e;
  text-align: center;
}

/* ERROR MESSAGE */
#error {
  color: #b91c1c;
  font-weight: 700;
  margin-top: 12px;
  text-align: center;
}

/* FADE IN ANIMATION */
@keyframes fadeIn {
  from {opacity:0; transform: translateY(-10px);}
  to {opacity:1; transform: translateY(0);}
}
</style>
</head>
<body>
<div class="card">
  <h1>Cek Data Yearbook</h1>

  <label>Kelas</label>
  <select id="kelas"><option value="">Memuat kelas...</option></select>

  <label>Nama</label>
  <select id="nama" disabled><option value="">Pilih kelas dulu...</option></select>

  <label>Tanggal Lahir</label>
  <input type="date" id="tgl">

  <button id="btn">Lihat Data</button>
  <div id="error" class="error"></div>

  <div id="result" class="result">
    <div>
      <strong>Nama:</strong> <span id="r_nama"></span>
      <span id="r_nama_count" class="char-count"></span>
      <span id="r_nama_notice" class="warning-msg"></span>
    </div>
    <div><strong>Tempat Lahir:</strong> <span id="r_tempat"></span></div>
    <div><strong>Tanggal Lahir:</strong> <span id="r_tanggal"></span></div>
    <div>
      <strong>Quotes:</strong> <span id="r_quotes"></span>
      <span id="r_quotes_count" class="char-count"></span>
      <span id="r_quotes_notice" class="warning-msg"></span>
    </div>
    <div><strong>IG:</strong> <span id="r_ig"></span></div>
  </div>

  <div class="notice">
    ⚠️ <strong>Perhatian!</strong>  
    Jika terdapat kesalahan data atau perlu revisi, silakan hubungi PJ kelas masing-masing.  
    Data yang baru diinput akan muncul dalam <strong>±1 menit</strong>.
  </div>
</div>

<script>
// ===== SCRIPT DATA =====
const SPREADSHEET_ID = "1uvTlImAizIXasaLOxagWCAaOax3TB9Z0eub34TFUxV8";
const GID = "664816169";
const CSV_URL = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/export?format=csv&gid=${GID}&t=${Date.now()}`;

const selKelas = document.getElementById('kelas');
const selNama = document.getElementById('nama');
const inputTgl = document.getElementById('tgl');
const btn = document.getElementById('btn');
const boxError = document.getElementById('error');
const boxResult = document.getElementById('result');

const r_nama = document.getElementById('r_nama');
const r_tempat = document.getElementById('r_tempat');
const r_tanggal = document.getElementById('r_tanggal');
const r_quotes = document.getElementById('r_quotes');
const r_ig = document.getElementById('r_ig');

const r_nama_count = document.getElementById('r_nama_count');
const r_quotes_count = document.getElementById('r_quotes_count');
const r_nama_notice = document.getElementById('r_nama_notice');
const r_quotes_notice = document.getElementById('r_quotes_notice');

let DATA = [];

function parseCSV(str) {
    const lines = str.split(/\r?\n/).filter(l=>l.trim());
    const headers = lines[0].split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/).map(h=>h.trim().toLowerCase().replace(/\s+/g,'_'));
    return lines.slice(1).map(l=>{
        const values = l.split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/).map(v=>v.trim().replace(/^"|"$/g,''));
        const obj = {};
        headers.forEach((h,i)=> obj[h]=values[i]||'');
        return obj;
    });
}

function normalizeDate(str){
    if(!str) return '';
    str = str.trim().toLowerCase().replace(/\./g,'');
    const monthMap = {
        jan:'01', january:'01', feb:'02', february:'02', mar:'03', march:'03',
        apr:'04', april:'04', mei:'05', may:'05', jun:'06', june:'06',
        jul:'07', july:'07', agu:'08', agustus:'08', aug:'08', august:'08',
        sep:'09', sept:'09', september:'09', okt:'10', oct:'10', october:'10',
        nov:'11', november:'11', des:'12', dec:'12', december:'12'
    };
    let m = str.match(/^(\d{1,2})[-\/]?([a-zA-Z]{3,})[-\/]?(\d{4})$/);
    if(m){
        let dd = m[1].padStart(2,'0');
        let mm = monthMap[m[2]] || '01';
        let yyyy = m[3];
        return `${yyyy}-${mm}-${dd}`;
    }
    m = str.match(/^(\d{1,2})[-\/](\d{1,2})[-\/](\d{2,4})$/);
    if(m){
        let dd = m[1].padStart(2,'0');
        let mm = m[2].padStart(2,'0');
        let yyyy = m[3].length===2 ? '20'+m[3] : m[3];
        return `${yyyy}-${mm}-${dd}`;
    }
    return '';
}

async function loadData(){
    try{
        const res = await fetch(CSV_URL);
        const text = await res.text();
        DATA = parseCSV(text);
        DATA.forEach(r=>{ if(r.tanggal_lahir) r.tanggal_lahir = normalizeDate(r.tanggal_lahir); });
        populateKelas();
    }catch(e){
        console.error(e);
        boxError.textContent='Gagal memuat data';
    }
}

function populateKelas(){
    const kelasSet = new Set(DATA.map(r=>r.kelas.trim()).filter(Boolean));
    selKelas.innerHTML='<option value="">-- Pilih Kelas --</option>';
    kelasSet.forEach(k=>{
        const opt = document.createElement('option'); opt.value=k; opt.textContent=k;
        selKelas.appendChild(opt);
    });
    selNama.innerHTML='<option value="">Pilih kelas dulu...</option>'; selNama.disabled=true;
}

selKelas.addEventListener('change',()=>{
    const kelas = selKelas.value.trim().toLowerCase();
    const filtered = DATA.filter(r=>r.kelas.trim().toLowerCase()===kelas);
    const names = [...new Set(filtered.map(r=>r.nama.trim()).filter(Boolean))];
    selNama.innerHTML='<option value="">-- Pilih Nama --</option>';
    names.forEach(n=>{
        const opt = document.createElement('option'); opt.value=n; opt.textContent=n;
        selNama.appendChild(opt);
    });
    selNama.disabled = names.length===0;
    inputTgl.value=''; boxResult.style.display='none'; boxError.textContent='';
});

btn.addEventListener('click',()=>{
    boxResult.style.display='none'; 
    boxError.textContent='';
    r_nama_notice.textContent = '';
    r_quotes_notice.textContent = '';

    const kelas = selKelas.value.trim().toLowerCase();
    const nama = selNama.value.trim();
    const tgl = inputTgl.value.trim();
    if(!kelas){ boxError.textContent='Pilih kelas terlebih dahulu'; return; }
    if(!nama){ boxError.textContent='Pilih nama terlebih dahulu'; return; }
    if(!tgl){ boxError.textContent='Masukkan tanggal lahir'; return; }

    const found = DATA.find(r=>{
        return r.kelas.trim().toLowerCase()===kelas &&
               r.nama.trim()===nama &&
               r.tanggal_lahir===tgl;
    });
    if(!found){ 
        boxError.textContent='Data tidak ditemukan (cek kelas/nama/tanggal lahir)';
        boxError.style.color = '#b91c1c'; // merah
        return; 
    }

    r_nama.textContent = found.nama;
    r_tempat.textContent = found.tempat_lahir || '-';
    r_tanggal.textContent = found.tanggal_lahir || '-';
    r_quotes.textContent = found.quotes || '-';
    r_ig.textContent = found.ig || '-';

    // Nama
    const namaLength = found.nama.length;
    r_nama_count.textContent = `(${namaLength}/20 karakter)`;
    r_nama_count.classList.remove('warning');
    if(namaLength > 20){
        r_nama_count.textContent += ' ⚠ Terlalu panjang!';
        r_nama_count.classList.add('warning');
        r_nama_notice.textContent = "⚠️ Nama melebihi batas. Silakan hubungi PJ kelas masing-masing.";
    }

    // Quotes
    const quotesWords = found.quotes ? found.quotes.trim().split(/\s+/) : [];
    r_quotes_count.textContent = `(${quotesWords.length}/10 kata)`;
    r_quotes_count.classList.remove('warning');
    if(quotesWords.length > 10){
        r_quotes_count.textContent += ' ⚠ Terlalu panjang!';
        r_quotes_count.classList.add('warning');
        r_quotes_notice.textContent = "⚠️ Quotes melebihi batas. Silakan hubungi PJ kelas masing-masing.";
    }

    boxResult.style.display='block';
});

loadData();
</script>
</body>
</html>
